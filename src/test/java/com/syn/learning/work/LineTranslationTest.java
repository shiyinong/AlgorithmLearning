package com.syn.learning.work;

import com.vividsolutions.jts.geom.Coordinate;
import com.vividsolutions.jts.geom.Geometry;
import com.vividsolutions.jts.geom.GeometryFactory;
import com.vividsolutions.jts.io.ParseException;
import com.vividsolutions.jts.io.WKTReader;
import com.vividsolutions.jts.io.gml2.GMLReader;
import org.junit.Test;
import org.xml.sax.SAXException;

import javax.xml.parsers.ParserConfigurationException;
import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.IOException;
import java.util.List;


public class LineTranslationTest {

    private String gml2="<gml:LineString srsName=\"SDO:8307\" xmlns:gml=\"http://www.opengis.net/gml\"><gml:coordinates decimal=\".\" cs=\",\" ts=\" \">114.4221263,30.4948799,40.22102978174 114.4221049,30.4948595,40.27070831601 114.4220824,30.49484,40.28843022324 114.4220589,30.4948226,40.33974802773 114.422033,30.4948062,40.34408118296 114.4220058,30.4947927,40.39999343082 114.4219771,30.4947812,40.41230410989 114.421948,30.494773,40.46280575078 114.4219171,30.4947653,40.49127560481 114.4218864,30.4947597,40.56490069721 114.4218551,30.4947561,40.60646113288 114.4218245,30.4947548,40.69966353569 114.4217915,30.4947551,40.74172363523 114.4217616,30.4947577,40.83300183807 114.4217291,30.4947617,40.88409911934 114.4216988,30.4947673,40.96797687002 114.4216692,30.494774,41.04604680371 114.4216395,30.494782,41.1522221528 114.4216099,30.4947908,41.23316000402 114.4215804,30.4948002,41.32497898582 114.4215487,30.4948103,41.40869852528 114.4213175,30.4948903,42.1863574991 114.4211935,30.4949316,42.09841405135 114.4211399,30.4949517,42.7248637164 114.4210795,30.4949725,42.92048391886 114.4210196,30.4949927,43.10655071773 114.420958,30.4950155,43.2307360936 114.4208984,30.495039,43.31269126479 114.420871,30.4950509,43.35414990596 114.4208393,30.4950657,43.3739316836 114.4207854,30.4950949,43.42997022998 114.4207313,30.4951283,43.49401698913 114.4207087,30.4951451,43.49525839835 114.4206812,30.4951682,43.45613052882 114.4206632,30.4951859,43.48058410455 114.4206432,30.4952084,43.46566834021 114.4206264,30.4952293,43.46829620562 114.4206097,30.4952531,43.43263219111 114.4205818,30.495301,43.37479263172 114.4205703,30.4953261,43.35541415308 114.4205602,30.4953519,43.33380793873 114.4205524,30.4953773,43.31504150201 114.4205461,30.4954044,43.28582254052 114.4205419,30.4954308,43.2636296181 114.4205393,30.4954588,43.22268450912 114.4205389,30.4954847,43.21688038483 114.4205395,30.4955118,43.18844914623 114.4205431,30.4955384,43.16056538653 114.4205482,30.4955657,43.12040537782 114.420555,30.4955912,43.09855619166 114.4205635,30.4956143,43.1696977336 114.4205732,30.495643,43.06024342496 114.4205853,30.4956687,43.05042619165 114.4205968,30.4956906,43.0540380273 114.4206132,30.4957174,42.96986776404 114.4206493,30.4957598,42.90784170013 114.42069,30.4958021,42.95911495946 114.4207108,30.4958202,42.96285539586 114.4207351,30.4958387,42.98845918011 114.4207592,30.4958536,43.02818163764 114.420787,30.49587,43.05569694284 114.4208106,30.495881,43.15505008493 114.4208399,30.4958943,43.25913618039 114.4208694,30.495905,43.35415767599 114.4208999,30.4959136,43.45558130275 114.4209289,30.4959196,43.57793329936 114.4209604,30.495925,43.67400177941 114.4209903,30.4959293,43.82555363793 114.4210214,30.4959331,43.95115238335 114.4210507,30.4959336,44.12518640049 114.4210844,30.4959331,44.29318216629 114.4211149,30.49593,44.45849971008 114.4211455,30.4959262,44.59260669537 114.4211724,30.495922,44.77523823082 </gml:coordinates></gml:LineString>";
    private String gml1="<gml:LineString srsName=\"SDO:8307\" xmlns:gml=\"http://www.opengis.net/gml\"><gml:coordinates decimal=\".\" cs=\",\" ts=\" \">114.4214141,30.4958734,45.83031576686 114.4214975,30.4958375,46.17144486401 114.4215861,30.4957978,46.56084197573 114.4216622,30.4957611,46.97919002548 114.4217212,30.4957326,47.22160465736 114.4218257,30.4956802,47.67886098102 114.4218769,30.4956532,47.95353032649 114.4219322,30.4956235,48.21627903357 114.4219829,30.4955961,48.47858050838 114.4220309,30.49557,48.69873984996 114.4220864,30.495539,48.97183706611 114.4221389,30.4955095,49.19652893022 114.4221895,30.4954807,49.41202835552 114.4222435,30.4954497,49.62979600765 114.422297,30.4954178,49.81541500054 114.4223463,30.4953902,50.00521283317 114.4223964,30.4953619,50.14634708222 114.422448,30.4953319,50.21557304543 114.422503,30.4952993,50.32905923203 114.4225554,30.4952687,50.37471117079 114.4226066,30.4952388,50.37291554641 114.4226583,30.495209,50.33419641759 114.4227091,30.4951796,50.25199110527 114.4227624,30.4951493,50.14227094315 114.422814,30.4951188,50.06262245961 114.4228656,30.4950888,49.90017671976 114.4229141,30.4950614,49.80186894257 114.4229678,30.4950306,49.60325829871 </gml:coordinates></gml:LineString>";

    private String point1="POINT(114.421413568 30.495872125)";
    private String point2="POINT(114.42263616 30.49522339)";
    private String point3="POINT(114.420545540 30.495417829)";
    private String point4="POINT(114.422117798 30.494869795)";

    @Test
    public void lineTranslation() throws IOException, SAXException, ParserConfigurationException, ParseException {
        BufferedWriter bw=new BufferedWriter(new FileWriter("C:\\Users\\shiyinong\\Desktop\\test\\d.txt"));
        bw.write(LineTranslation.lineTranslation(gml2wkt(gml1), point1));
        bw.write("\n");
        bw.write(LineTranslation.lineTranslation(gml2wkt(gml1), point2));
        bw.write("\n");
        bw.write(LineTranslation.lineTranslation(gml2wkt(gml2), point3));
        bw.write("\n");
        bw.write(LineTranslation.lineTranslation(gml2wkt(gml2), point4));
        bw.close();

    }


    private static String gml2wkt(String gml) throws ParserConfigurationException, SAXException, IOException {
        GMLReader gmlReader = new GMLReader();
        Geometry geometry = gmlReader.read(gml, new GeometryFactory());
        StringBuilder wkt=new StringBuilder("LINESTRING(");
        Coordinate[] coordinates = geometry.getCoordinates();
        for(Coordinate coord : coordinates){
            wkt.append(coord.x);
            wkt.append(" ");
            wkt.append(coord.y);
            wkt.append(" ");
            wkt.append(coord.z);
            wkt.append(",");
        }
        wkt.setCharAt(wkt.length()-1,')');
        return wkt.toString();
    }


}